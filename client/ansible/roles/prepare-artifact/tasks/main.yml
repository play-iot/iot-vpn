# TODO: Add downloader
#- name: Download artifact

- name: Lookup VPNC CLI binary by arch
  ansible.builtin.set_fact:
    vpnc_artifact_arch: "{{ arch_mapping.get(ansible_architecture, None) }}"

- name: Validate VPNC CLI binary
  when: not vpnc_artifact_arch
  ansible.builtin.fail:
    msg: "Unsupported architecture [{{ansible_architecture}}]"

- name: Create application directory if it does not exist
  ansible.builtin.file:
    path: "{{ arg_app_dir }}"
    state: directory
    mode: 0755

- name: Transfer VPNC CLI binary
  ansible.builtin.copy:
    src: "{{vpnc_artifact}}-{{ vpnc_artifact_arch }}"
    dest: "{{ arg_app_dir }}/{{ vpnc_cli }}"
    owner: root
    group: root
    mode: 0755

- name: Create executable symlink for VPNC CLI
  ansible.builtin.file:
    src: "{{ arg_app_dir }}/{{ vpnc_cli }}"
    dest: "{{ unix_bin_dir }}/{{ vpnc_cli }}"
    owner: root
    group: root
    state: link
    force: true
